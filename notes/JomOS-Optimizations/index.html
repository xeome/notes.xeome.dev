<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Optimized repositories JomOS adds optimized repositories automatically to improve performance and system responsiveness. These repositories also include custom kernels with various CPU schedulers and other goodies."><title>JomOS Optimizations</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://xeome.github.io//icon.png><link href=https://xeome.github.io/styles.706bb6073ba85d26809f9096dae23a6b.min.css rel=stylesheet><link href=https://xeome.github.io/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://xeome.github.io/js/darkmode.7f967d9bd2d1cac02e762b5c57efc6ae.min.js></script>
<script src=https://xeome.github.io/js/util.5e39932758f9ecaf45fd54506ed61416.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://xeome.github.io/js/popover.6da9b273c092cc16fc1aa904d71a2163.min.js></script>
<script src=https://xeome.github.io/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://xeome.github.io/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://xeome.github.io/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=null,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://xeome.github.io/",fetchData=Promise.all([fetch("https://xeome.github.io/indices/linkIndex.052cb061cb9ae05d6ccaa2b8acdd3aa2.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://xeome.github.io/indices/contentIndex.3a5ae44aaa6d915a09074f8f3a50cf14.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://xeome.github.io",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://xeome.github.io",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/xeome.github.io\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://xeome.github.io/js/full-text-search.51f0b1753e9b30839d053f8a98cc20d1.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://xeome.github.io/>ðŸª´ Quartz 3.3</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>JomOS Optimizations</h1><p class=meta>Last updated
Dec 28, 2022
<a href=https://github.com/xeome/notes/JomOS%20Optimizations.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#optimized-repositories>Optimized repositories</a><ol><li><a href=#compiler-optimizations>Compiler optimizations</a></li></ol></li><li><a href=#default-browser-thorium>Default browser Thorium</a></li><li><a href=#tuned-sysctl-values-and-other-configurations>Tuned sysctl values and other configurations</a><ol><li><a href=#etcsysctld99-jomos-settingsconf>/etc/sysctl.d/99-JomOS-settings.conf</a></li><li><a href=#etcudevrulesdioschedulerrules>/etc/udev/rules.d/ioscheduler.rules</a></li><li><a href=#etcmkinitcpioconf>/etc/mkinitcpio.conf</a></li><li><a href=#etcsystemdzram-generatorconf>/etc/systemd/zram-generator.conf</a></li></ol></li></ol><ol><li><a href=#benchmarks>Benchmarks</a></li></ol></nav></details></aside><a href=#optimized-repositories><h2 id=optimized-repositories><span class=hanchor arialabel=Anchor># </span>Optimized repositories</h2></a><p>JomOS adds optimized repositories automatically to improve performance and system responsiveness. These repositories also include custom kernels with various CPU schedulers and other goodies.</p><p>The optimizations used in the repositories are listed below.</p><a href=#compiler-optimizations><h3 id=compiler-optimizations><span class=hanchor arialabel=Anchor># </span>Compiler optimizations</h3></a><p>-march is the first and most important option. This instructs GCC(or other compilers) to generate code for a specific type of CPU. Different CPUs have different capabilities, support different instruction sets, and execute code in different ways. The -march flag instructs the compiler to generate specific code for the selected architecture, including all of its capabilities, features, instruction sets, quirks, and so on.</p><p>If the CPU type is unknown, or if the user is unsure which setting to use, the -march=native option can be used. When this flag is set, GCC will attempt to detect the processor and set appropriate flags for it automatically. This should not be used if you want to compile packages for different CPUs!</p><p>When compiling packages on one computer to run on another (for example, when using a fast computer to build for an older, slower machine), do not use -march=native. The term &ldquo;native&rdquo; indicates that the code produced will only run on that type of CPU. Applications developed with -march=native on an Intel Core CPU will not run on an old Intel Atom CPU.</p><p>These are the four x86-64 microarchitecture levels on top of the x86-64 baseline:</p><ul><li>x86-64: CMOV, CMPXCHG8B, FPU, FXSR, MMX, FXSR, SCE, SSE, SSE2</li><li>x86-64-v2: (close to Nehalem) CMPXCHG16B, LAHF-SAHF, POPCNT, SSE3, SSE4.1, SSE4.2, SSSE3</li><li>x86-64-v3: (close to Haswell) AVX, AVX2, BMI1, BMI2, F16C, FMA, LZCNT, MOVBE, XSAVE</li><li>x86-64-v4: AVX512F, AVX512BW, AVX512CD, AVX512DQ, AVX512VL</li></ul><p>Most Linux distributions use x86-64-v2 for compatibility with older hardware, but this may limit performance on newer hardware. We detect whether your CPU supports x86-64-v3 and add repositories accordingly. The performance improvement could range from 10% to 35% depending on the processor and software used.</p><p><img src=/notes/assets/img/benchmarks.png width=auto></p><p><img src=/notes/assets/img/O3_generic_O3_march_haswell_Comparison.png width=auto></p><p>To check if your cpu supports x86-64-v3, you can use the following command:
<code>/lib/ld-linux-x86-64.so.2 --help | grep "x86-64-v3 (supported, searched)"</code></p><p>If you get an output saying <code>x86-64-v3 (supported, searched)</code> then congratulations, your cpu supports x86-64-v3.</p><p>This repository is provided by CachyOS. As theres no reason to create our own v3 repositories. Many thanks to the CachyOS team for creating and maintaining this repository.</p><a href=#default-browser-thorium><h2 id=default-browser-thorium><span class=hanchor arialabel=Anchor># </span>Default browser Thorium</h2></a><p>As far as I am aware, Thorium is the fastest browser available. It also makes use of some of the compiler optimizations we use, as well as others; for more information, see <a href=/notes/Thorium rel=noopener class=internal-link data-src=/notes/Thorium>Thorium</a>.</p><a href=#tuned-sysctl-values-and-other-configurations><h2 id=tuned-sysctl-values-and-other-configurations><span class=hanchor arialabel=Anchor># </span>Tuned sysctl values and other configurations</h2></a><a href=#etcsysctld99-jomos-settingsconf><h3 id=etcsysctld99-jomos-settingsconf><span class=hanchor arialabel=Anchor># </span>/etc/sysctl.d/99-JomOS-settings.conf</h3></a><p>This file contains JomOS sysctl tweaks.</p><a href=#vmswappiness><h4 id=vmswappiness><span class=hanchor arialabel=Anchor># </span>vm.swappiness</h4></a><p>The swappiness sysctl parameter represents the kernel&rsquo;s preference (or avoidance) of swap space. Swappiness can have a value between 0 and 100, the default value is 60.</p><p>A low value causes the kernel to avoid swapping, a higher value causes the kernel to try to use swap space. Using a low value on sufficient memory is known to improve responsiveness on many systems.</p><p>This value is automatically calculated using your ram amount</p><a href=#vmvfs_cache_pressure><h4 id=vmvfs_cache_pressure><span class=hanchor arialabel=Anchor># </span>vm.vfs_cache_pressure</h4></a><p>The value controls the tendency of the kernel to reclaim the memory which is used for caching of directory and inode objects (VFS cache).</p><p>Lowering it from the default value of 100 makes the kernel less inclined to reclaim VFS cache (do not set it to 0, this may produce out-of-memory conditions)</p><p>This value is automatically calculated using your ram amount</p><a href=#vmpage-cluster><h4 id=vmpage-cluster><span class=hanchor arialabel=Anchor># </span>vm.page-cluster</h4></a><p>refer toÂ 
<a href=https://xeome.github.io/notes/Zram#page-cluster-values-latency-difference rel=noopener>https://xeome.github.io/notes/Zram#page-cluster-values-latency-difference</a></p><a href=#vmdirty_ratio><h4 id=vmdirty_ratio><span class=hanchor arialabel=Anchor># </span>vm.dirty_ratio</h4></a><p>Contains, as a percentage of total available memory that contains free pages and reclaimable pages, the number of pages at which a process which is generating disk writes will itself start writing out dirty data (Default is 20).</p><a href=#vmdirty_background_ratio><h4 id=vmdirty_background_ratio><span class=hanchor arialabel=Anchor># </span>vm.dirty_background_ratio</h4></a><p>Contains, as a percentage of total available memory that contains free pages and reclaimable pages, the number of pages at which the background kernel flusher threads will start writing out dirty data (Default is 10).</p><a href=#network-tweaks-only-for-cachyos-kernels><h4 id=network-tweaks-only-for-cachyos-kernels><span class=hanchor arialabel=Anchor># </span>Network tweaks (only for CachyOS kernels)</h4></a><p>The BBR congestion control algorithm can help achieve higher bandwidths and lower latencies for internet traffic</p><p>TCP Fast Open is an extension to the transmission control protocol (TCP) that helps reduce network latency by enabling data to be exchanged during the senderâ€™s initial TCP SYN. Using the value 3 instead of the default 1 allows TCP Fast Open for both incoming and outgoing connections</p><a href=#kernelnmi_watchdog><h4 id=kernelnmi_watchdog><span class=hanchor arialabel=Anchor># </span>kernel.nmi_watchdog</h4></a><p>Disabling NMI watchdog will speed up your boot and shutdown, because one less module is loaded. Additionally disabling watchdog timers increases performance and lowers power consumption</p><a href=#etcudevrulesdioschedulerrules><h3 id=etcudevrulesdioschedulerrules><span class=hanchor arialabel=Anchor># </span>/etc/udev/rules.d/ioscheduler.rules</h3></a><p>The kernel component that determines the order in which block I/O operations are submitted to storage devices is the input/output (I/O) scheduler.The goal of the I/O scheduler is to optimize how these can deal with read requests, it is useful to review some specifications of the two main drive types:</p><ul><li><p>An HDD has spinning disks and a physical head that moves to the required location. As a result, random latency is quite high, ranging between 3 and 12ms (depending on whether it is a high-end server drive or a laptop drive bypassing the disk controller write buffer), whereas sequential access provides significantly higher throughput. The average HDD throughput is approximately 200 I/O operations per second (IOPS).</p></li><li><p>An SSD does not have moving parts, random access is as fast as sequential one, typically under 0.1ms, and it can handle multiple concurrent requests. The typical SSD throughput is greater than 10,000 IOPS, which is more than needed in common workload situations.</p></li></ul><p>Thousands of IOPS can be generated if multiple processes make I/O requests to different storage parts, whereas a typical HDD can only handle about 200 IOPS. There is a queue of requests that must wait for storage access. This is where I/O schedulers can help with optimization.</p><p>The best scheduler to use is determined by both the device and the specific nature of the workload. Furthermore, throughput in MB/s is not the only measure of performance: deadlines or fairness reduce overall throughput while improving system responsiveness.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=c1># set scheduler for NVMe</span>
</span></span><span class=line><span class=cl><span class=na>ACTION</span><span class=o>=</span><span class=s>=&#34;add|change&#34;, KERNEL==&#34;nvme[0-9]n[0-9]&#34;, ATTR{queue/scheduler}=&#34;none&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># set scheduler for SSD and eMMC</span>
</span></span><span class=line><span class=cl><span class=na>ACTION</span><span class=o>=</span><span class=s>=&#34;add|change&#34;, KERNEL<mark>&#34;sd[a-z]*|mmcblk[0-9]*&#34;, ATTR{queue/rotational}</mark>&#34;0&#34;, ATTR{queue/scheduler}=&#34;mq-deadline&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># set scheduler for rotating disks</span>
</span></span><span class=line><span class=cl><span class=na>ACTION</span><span class=o>=</span><span class=s>=&#34;add|change&#34;, KERNEL<mark>&#34;sd[a-z]*&#34;, ATTR{queue/rotational}</mark>&#34;1&#34;, ATTR{queue/scheduler}=&#34;bfq&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>For example theÂ 
<a href=https://wiki.archlinux.org/title/Udev rel=noopener>udev</a>Â rule above sets the scheduler toÂ <em>none</em>Â forÂ 
<a href=https://wiki.archlinux.org/title/NVMe rel=noopener>NVMe</a>,Â <em>mq-deadline</em>Â forÂ 
<a href=https://wiki.archlinux.org/title/SSD rel=noopener>SSD</a>/eMMC, andÂ <em>bfq</em>Â for rotational drives:</p><a href=#etcmkinitcpioconf><h3 id=etcmkinitcpioconf><span class=hanchor arialabel=Anchor># </span>/etc/mkinitcpio.conf</h3></a><p>Base and udev replaced with systemd for faster boots and set compression algorithm to zstd and compression level to 2 because compression ratio increase isn&rsquo;t worth the increased boot time.</p><a href=#etcsystemdzram-generatorconf><h3 id=etcsystemdzram-generatorconf><span class=hanchor arialabel=Anchor># </span>/etc/systemd/zram-generator.conf</h3></a><p>Use zstd compression by default, for more information visitÂ <a href=/notes/Zram rel=noopener class=internal-link data-src=/notes/Zram>Zram</a></p><a href=#sources><h1 id=sources><span class=hanchor arialabel=Anchor># </span>Sources</h1></a><a href=#benchmarks><h2 id=benchmarks><span class=hanchor arialabel=Anchor># </span>Benchmarks</h2></a><p><a href=https://lists.archlinux.org/pipermail/arch-general/2021-March/048739.html rel=noopener>https://lists.archlinux.org/pipermail/arch-general/2021-March/048739.html</a></p><p><a href="https://openbenchmarking.org/result/2103142-HA-UARCHLEVE55&rmm=O1_generic%2CO3_march_nehalem" rel=noopener>https://openbenchmarking.org/result/2103142-HA-UARCHLEVE55&rmm=O1_generic%2CO3_march_nehalem</a></p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/notes/JomOS/ data-ctx="notes/JomOS Optimizations" data-src=/notes/JomOS class=internal-link>JomOS</a></li><li><a href=/notes/Linux/ data-ctx="notes/JomOS Optimizations" data-src=/notes/Linux class=internal-link>Linux</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://xeome.github.io/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by xeome using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2022</p><ul><li><a href=https://xeome.github.io/>Home</a></li><li><a href=https://github.com/xeome>Github</a></li></ul></footer></div></div></body></html>