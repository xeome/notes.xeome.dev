<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="WARNING: WORK IN PROGRESS Introduction In this document, I will try to explain various optimization techniques that can be applied to software development to improve its performance, power efficiency, and security."><meta property="og:title" content="Optimization Techniques"><meta property="og:description" content="WARNING: WORK IN PROGRESS Introduction In this document, I will try to explain various optimization techniques that can be applied to software development to improve its performance, power efficiency, and security."><meta property="og:type" content="website"><meta property="og:image" content="https://xeome.github.io/icon.png"><meta property="og:url" content="https://xeome.github.io/notes/Optimization-Techniques/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Optimization Techniques"><meta name=twitter:description content="WARNING: WORK IN PROGRESS Introduction In this document, I will try to explain various optimization techniques that can be applied to software development to improve its performance, power efficiency, and security."><meta name=twitter:image content="https://xeome.github.io/icon.png"><title>Optimization Techniques</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://xeome.github.io//icon.png><link href=https://xeome.github.io/styles.ec4dbc0520be7bdf4aca4fa74d672b05.min.css rel=stylesheet><link href=https://xeome.github.io/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://xeome.github.io/js/darkmode.7f967d9bd2d1cac02e762b5c57efc6ae.min.js></script>
<script src=https://xeome.github.io/js/util.a0ccf91e1937fe761a74da4946452710.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script async src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script async src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script async src=https://xeome.github.io/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://xeome.github.io/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://xeome.github.io/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://xeome.github.io/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://xeome.github.io/",fetchData=Promise.all([fetch("https://xeome.github.io/indices/linkIndex.869aa3843258020286621a261e1606a1.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://xeome.github.io/indices/contentIndex.446417850f6952fcb7e36a81efa3fc1c.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://xeome.github.io",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://xeome.github.io",t,[{"/moc":"#4388cc"}],t?{centerForce:.5,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:4,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/xeome.github.io\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=xeome.github.io src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://xeome.github.io/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://xeome.github.io/>ðŸª´ Quartz 3.3</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Optimization Techniques</h1><p class=meta>Last updated
Feb 11, 2023
<a href=https://github.com/xeome/xeome.github.io/tree/hugo/content/notes/Optimization%20Techniques.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#definition-and-concept>Definition and concept</a></li><li><a href=#how-lto-works>How LTO works</a></li></ol><ol><li><a href=#definition-and-concept-1>Definition and concept</a></li><li><a href=#how-bolt-works>How BOLT works</a></li></ol><ol><li><a href=#overview-of-compiler-flags>Overview of compiler flags</a></li><li><a href=#commonly-used-flags-for-optimization>Commonly used flags for optimization</a></li></ol><ol><li><a href=#definition-and-concept-2>Definition and concept</a></li><li><a href=#how-polly-works>How POLLY works</a></li></ol><ol><li><a href=#dead-code-elimination>Dead Code Elimination</a></li><li><a href=#constant-propagation>Constant Propagation</a></li><li><a href=#register-allocation>Register Allocation</a></li><li><a href=#loop-unrolling>Loop Unrolling</a></li><li><a href=#inlining>Inlining</a></li><li><a href=#instruction-scheduling>Instruction Scheduling</a></li><li><a href=#vectorization>Vectorization</a></li><li><a href=#interprocedural-optimization-ipo>Interprocedural Optimization (IPO)</a></li></ol></nav></details></aside><a href=#warning-work-in-progress><h1 id=warning-work-in-progress><span class=hanchor arialabel=Anchor># </span>WARNING: WORK IN PROGRESS</h1></a><a href=#introduction><h1 id=introduction><span class=hanchor arialabel=Anchor># </span>Introduction</h1></a><p>In this document, I will try to explain various optimization techniques that can be applied to software development to improve its performance, power efficiency, and security. These techniques include Profile-Guided Optimization (PGO), Link-Time Optimization (LTO), LLVM BOLT, Compiler Flags, and other optimization techniques such as dead code elimination, constant propagation, register allocation, loop unrolling, inlining, instruction scheduling and vectorization, and interprocedural optimization (IPO). I will explain the concepts, working mechanism, benefits, and limitations of each optimization technique, along with examples of how they can be applied in practice. By the end of this document, I hope that the readers will have a comprehensive understanding of the different optimization techniques available and be able to choose the appropriate optimization technique for their specific use case.</p><a href=#link-time-optimization-lto><h1 id=link-time-optimization-lto><span class=hanchor arialabel=Anchor># </span>Link-Time Optimization (LTO)</h1></a><a href=#definition-and-concept><h2 id=definition-and-concept><span class=hanchor arialabel=Anchor># </span>Definition and concept</h2></a><a href=#how-lto-works><h2 id=how-lto-works><span class=hanchor arialabel=Anchor># </span>How LTO works</h2></a><a href=#llvm-bolt><h1 id=llvm-bolt><span class=hanchor arialabel=Anchor># </span>LLVM BOLT</h1></a><a href=#definition-and-concept-1><h2 id=definition-and-concept-1><span class=hanchor arialabel=Anchor># </span>Definition and concept</h2></a><p>LLVM BOLT (Binary Optimization and Analysis Tool) is a tool for optimizing and analyzing binary code. It is built on top of the LLVM compiler infrastructure, and it works by analyzing the control flow graph (CFG) of the binary code and applying a variety of optimization techniques to improve performance.</p><a href=#how-bolt-works><h2 id=how-bolt-works><span class=hanchor arialabel=Anchor># </span>How BOLT works</h2></a><p>BOLT runs passes with either code transformations or analyses, similar to a compiler. BOLT is also equipped with a data-flow analysis framework to feed information to passes that need it. Some passes are architecture-independent while others are not. In this section, we discuss the passes applied to the Intel x86-64 target.</p><table><thead><tr><th style=text-align:left>Pass Name</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left>1. strip-rep-ret</td><td style=text-align:left>Strip repz from repz retq instructions used for legacy AMD processors</td></tr><tr><td style=text-align:left>2. icf</td><td style=text-align:left>Identical code folding</td></tr><tr><td style=text-align:left>3. icp</td><td style=text-align:left>Indirect call promotion</td></tr><tr><td style=text-align:left>4. peepholes</td><td style=text-align:left>Simple peephole optimizations</td></tr><tr><td style=text-align:left>5. simplify-ro-loads</td><td style=text-align:left>Fetch constant data in .rodata whose address is known statically and mutate a load into a mov</td></tr><tr><td style=text-align:left>6. icf</td><td style=text-align:left>Identical code folding (second run)</td></tr><tr><td style=text-align:left>7. plt</td><td style=text-align:left>Remove indirection from PLT calls</td></tr><tr><td style=text-align:left>8. reorder-bbs</td><td style=text-align:left>Reorder basic blocks and split hot/cold blocks into separate sections (layout optimization)</td></tr><tr><td style=text-align:left>9. peepholes</td><td style=text-align:left>Simple peephole optimizations (second run)</td></tr><tr><td style=text-align:left>10. uce</td><td style=text-align:left>Eliminate unreachable basic blocks</td></tr><tr><td style=text-align:left>11. fixup-branches</td><td style=text-align:left>Fix basic block terminator instructions to match the CFG and the current layout (redone by reorder-bbs)</td></tr><tr><td style=text-align:left>12. reorder-functions</td><td style=text-align:left>Apply HFSort to reorder functions (layout optimization)</td></tr><tr><td style=text-align:left>13. sctc</td><td style=text-align:left>Simplify conditional tail calls</td></tr><tr><td style=text-align:left>14. frame-opts</td><td style=text-align:left>Removes unnecessary caller-saved register spilling</td></tr><tr><td style=text-align:left>15. shrink-wrapping</td><td style=text-align:left>Moves callee-saved register spills closer to where they are needed, if profiling data shows it is better to do so</td></tr></tbody></table><p>Some parts of bellow information is rewritten and some are directly taken from the paper.</p><p>strip-rep-ret:</p><blockquote><p>In favor of I-cache space, such as removing alignment NOPs and AMD-friendly REPZ bytes, or using shorter versions of instructions. Our findings show that, for large applications, it is better to aggressively reduce I-cache occupation, except if the change incurs D-cache overhead since the cache is one of the most constrained resources in the data-center space. This explains BOLTâ€™s policy of discarding all NOPs after reading the input binary. Even though compiler-generated alignment NOPs are generally useful, the extra space required by them does not pay off and simply stripping them from the binary provides a small but measurable performance improvement.</p></blockquote><p>icf:</p><blockquote><p>BOLT features identical code folding (ICF) to complement the ICF optimization done by the linker. An additional benefit of doing ICF at the binary level is the ability to optimize functions that were compiled without the -ffunction-sections flag and functions that contain jump tables. As a result, BOLT is able to fold more identical functions than the linkers. We have measured the reduction of code size for the HHVM binary [19] to be about 3% on top of the linkerâ€™s ICF pass.</p></blockquote><p>icp and plt:</p><p>Passes 3 and 7 leverage call frequency information to optimize function calls. Pass 3, indirect call promotion, mutates a function call into a more performant version, while pass 7, PLT call optimization, removes indirection from PLT calls. BOLT also has the ability to do function inlining, but it is a limited version compared to what compilers perform at higher levels. The inlining opportunities that BOLT can take advantage of typically come from more accurate profile data, BOLTâ€™s own indirect-call promotion optimization, cross-module nature, or a combination of these factors.</p><p>simplify-ro-loads:</p><blockquote><p>Simplification of load instructions, explores a tricky tradeoff by fetching data from statically known values (in read-only sections). In these cases, BOLT may convert loads into immediate-loading instructions, relieving pressure from the D-cache but possibly increasing pressure on the I-cache, since the data is now encoded in the instruction stream. BOLTâ€™s policy, in this case, is to abort the promotion if the new instruction encoding is larger than the original load instruction, even if it means avoiding an arguably more computationally expensive load instruction. However, we found that such opportunities are not very frequent in our workloads.</p></blockquote><p>reorder-bbs:</p><blockquote><p>Pass 8, reorder and split hot/cold basic blocks, reorders basic blocks according to the most frequently executed paths, so the hottest successor will most likely be a fall-though, reducing taken branches and relieving pressure from the branch predic- tor unit</p></blockquote><a href=#profile-guided-optimization-pgo><h1 id=profile-guided-optimization-pgo><span class=hanchor arialabel=Anchor># </span>Profile-Guided Optimization (PGO)</h1></a><p>I recommend checking out the following document written by my friend which can be found at
<a href=https://misile00.github.io/notes/PGO rel=noopener>https://misile00.github.io/notes/PGO</a>. This document provides a detailed explanation of PGO and how it can be applied in practice.</p><a href=#compiler-flags><h1 id=compiler-flags><span class=hanchor arialabel=Anchor># </span>Compiler Flags</h1></a><a href=#overview-of-compiler-flags><h2 id=overview-of-compiler-flags><span class=hanchor arialabel=Anchor># </span>Overview of compiler flags</h2></a><a href=#commonly-used-flags-for-optimization><h2 id=commonly-used-flags-for-optimization><span class=hanchor arialabel=Anchor># </span>Commonly used flags for optimization</h2></a><a href=#llvm-polly><h1 id=llvm-polly><span class=hanchor arialabel=Anchor># </span>LLVM POLLY</h1></a><a href=#definition-and-concept-2><h2 id=definition-and-concept-2><span class=hanchor arialabel=Anchor># </span>Definition and concept</h2></a><a href=#how-polly-works><h2 id=how-polly-works><span class=hanchor arialabel=Anchor># </span>How POLLY works</h2></a><a href=#other-optimization-techniques><h1 id=other-optimization-techniques><span class=hanchor arialabel=Anchor># </span>Other Optimization Techniques</h1></a><a href=#dead-code-elimination><h2 id=dead-code-elimination><span class=hanchor arialabel=Anchor># </span>Dead Code Elimination</h2></a><a href=#constant-propagation><h2 id=constant-propagation><span class=hanchor arialabel=Anchor># </span>Constant Propagation</h2></a><a href=#register-allocation><h2 id=register-allocation><span class=hanchor arialabel=Anchor># </span>Register Allocation</h2></a><a href=#loop-unrolling><h2 id=loop-unrolling><span class=hanchor arialabel=Anchor># </span>Loop Unrolling</h2></a><a href=#inlining><h2 id=inlining><span class=hanchor arialabel=Anchor># </span>Inlining</h2></a><a href=#instruction-scheduling><h2 id=instruction-scheduling><span class=hanchor arialabel=Anchor># </span>Instruction Scheduling</h2></a><a href=#vectorization><h2 id=vectorization><span class=hanchor arialabel=Anchor># </span>Vectorization</h2></a><a href=#interprocedural-optimization-ipo><h2 id=interprocedural-optimization-ipo><span class=hanchor arialabel=Anchor># </span>Interprocedural Optimization (IPO)</h2></a></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/notes/Misc/ data-ctx="notes/Optimization Techniques" data-src=/notes/Misc class=internal-link>Misc</a></li><li><a href=/notes/Resources/ data-ctx="notes/Optimization Techniques" data-src=/notes/Resources class=internal-link>Resources</a></li></ul></div><div><script async src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://xeome.github.io/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by xeome using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://xeome.github.io/>Home</a></li><li><a href=https://github.com/xeome>Github</a></li></ul></footer></div></div></body></html>